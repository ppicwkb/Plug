<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Plug Kontainer (Lokasi Tersembunyi)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .loading {
            display: none;
        }
        .loading.show {
            display: flex;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        .animate-fadeInUp {
            animation: fadeInUp 0.6s ease-out;
        }
        .animate-slideInRight {
            animation: slideInRight 0.5s ease-out;
        }
        .glass-effect {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .gradient-border {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2px;
            border-radius: 12px;
        }
        .gradient-border-inner {
            background: white;
            border-radius: 10px;
        }
        /* Floating Label Styles */
        .input-group {
            position: relative;
        }
        .floating-label {
            position: absolute;
            top: 50%;
            left: 1rem;
            transform: translateY(-50%);
            transition: all 0.3s ease;
            pointer-events: none;
            background: white; 
            padding: 0 4px;
            margin-left: -4px;
        }
        .input-focused, .input-filled {
            /* Input is focused or has content */
        }
        .input-focused .floating-label, .input-filled .floating-label {
            top: 0;
            transform: translateY(-50%) scale(0.85);
            color: #4f46e5;
            font-weight: 600;
        }

        .custom-shadow {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .hover-lift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .status-badge {
            position: relative;
            overflow: hidden;
        }
        .status-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        .status-badge:hover::before {
            left: 100%;
        }
        @media (max-width: 640px) {
            .mobile-padding {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            .mobile-text {
                font-size: 1.5rem;
            }
            .mobile-card {
                margin: 0.5rem;
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 min-h-screen font-sans relative overflow-x-hidden">
    <div class="fixed inset-0 opacity-5 pointer-events-none">
        <div class="absolute inset-0" style="background-image: radial-gradient(circle at 25px 25px, #4f46e5 2px, transparent 0), radial-gradient(circle at 75px 75px, #7c3aed 2px, transparent 0); background-size: 100px 100px;"></div>
    </div>
    <div id="loginModal" class="fixed inset-0 bg-gradient-to-br from-black/60 via-blue-900/20 to-purple-900/30 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div class="glass-effect rounded-2xl custom-shadow p-8 max-w-md w-full mx-4 animate-fadeInUp">
            <div class="text-center mb-8">
                <div class="gradient-border mx-auto mb-6 w-20 h-20">
                    <div class="gradient-border-inner w-full h-full flex items-center justify-center">
                        <span class="text-3xl">üîê</span>
                    </div>
                </div>
                <h2 class="text-3xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent mb-3">Secure Access</h2>
                <p class="text-gray-600 text-sm leading-relaxed">Masukkan kredensial untuk mengakses</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div class="space-y-5">
                    
                    <div class="input-group">
                        <label for="username" class="floating-label text-sm text-gray-500">üë§ Username</label>
                        <input type="text" id="username" name="username" required 
                               class="w-full px-5 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 bg-white/80 backdrop-blur-sm text-gray-800 placeholder-transparent"
                               placeholder="Username">
                    </div>
                    
                    <div class="input-group">
                        <label for="password" class="floating-label text-sm text-gray-500">üîë Password</label>
                        <input type="password" id="password" name="password" required 
                               class="w-full px-5 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 bg-white/80 backdrop-blur-sm text-gray-800 placeholder-transparent"
                               placeholder="Password">
                    </div>
                </div>
                
                <div id="loginError" class="hidden bg-gradient-to-r from-red-50 to-red-100 border border-red-200 text-red-800 p-4 rounded-xl text-sm animate-slideInRight">
                    <div class="flex items-center">
                        <span class="text-red-500 mr-2">‚ö†Ô∏è</span>
                        Username atau password salah. Silakan coba lagi.
                    </div>
                </div>
                
                <button type="submit" id="loginBtn"
                        class="w-full bg-gradient-to-r from-blue-600 via-blue-700 to-indigo-700 text-white font-bold py-4 px-6 rounded-xl hover:from-blue-700 hover:via-blue-800 hover:to-indigo-800 transform hover:scale-[1.02] hover:shadow-2xl transition-all duration-300 shadow-xl relative overflow-hidden group">
                    <span class="relative z-10 flex items-center justify-center">
                        <span class="mr-2"></span>
                        Masuk ke Sistem
                    </span>
                    <div class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 transform -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-700"></div>
                </button>
            </form>
        </div>
    </div>

    <div id="mainContent" class="hidden relative z-10">
        <div class="container mx-auto mobile-padding py-6 sm:py-8 max-w-7xl">
            <div class="text-center mb-8 sm:mb-12 animate-fadeInUp">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                    <div class="hidden sm:block"></div>
                    <div class="text-center">
                        <h1 class="text-2xl sm:text-4xl lg:text-5xl font-bold bg-gradient-to-r from-gray-800 via-blue-800 to-indigo-800 bg-clip-text text-transparent mb-2">
                            üìã DATA PLUG KONTAINER
                        </h1>
                        <div class="w-24 h-1 bg-gradient-to-r from-blue-500 to-indigo-600 mx-auto rounded-full"></div>
                    </div>
                    <button onclick="logout()" 
                            class="bg-gradient-to-r from-red-50 to-red-100 hover:from-red-100 hover:to-red-200 text-red-700 font-semibold py-3 px-6 rounded-xl transition-all duration-300 text-sm border border-red-200 hover:border-red-300 hover-lift">
                        <span class="flex items-center">
                            <span class="mr-2">üö™</span>
                            Logout
                        </span>
                    </button>
                </div>
                <p class="text-gray-600 text-lg max-w-2xl mx-auto leading-relaxed">Manajemen data Plug kontainer</p>
            </div>

        <div class="glass-effect rounded-2xl custom-shadow mobile-card mb-8 hover-lift animate-fadeInUp">
            <div class="p-6 sm:p-8">
                <div class="flex items-center mb-8">
                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center mr-4">
                        <span class="text-white text-xl">üìù</span>
                    </div>
                    <div>
                        <h2 class="text-xl sm:text-2xl font-bold text-gray-800">Input Data </h2>
                        <p class="text-gray-600 text-sm">Lengkapi data</p>
                    </div>
                </div>
                
                <form id="dataForm" class="space-y-6">
                    <input type="hidden" id="row" name="row" value="">
                    
                    <input type="hidden" id="lokasi" name="lokasi" value="">

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div>
                            <label for="tanggal" class="block text-sm font-bold text-gray-700 mb-3">üìÖ Tanggal</label>
                            <input type="date" id="tanggal" name="tanggal" required
                                   class="w-full px-5 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 bg-white/80 backdrop-blur-sm text-gray-800">
                        </div>

                        <div>
                            <label for="inv" class="block text-sm font-bold text-gray-700 mb-3">üè∑Ô∏è Nomor INV</label>
                            <input type="text" id="inv" name="inv" required placeholder="Masukkan nomor INV"
                                   class="w-full px-5 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:focus:border-blue-500 transition-all duration-300 bg-white/80 backdrop-blur-sm text-gray-800 placeholder-gray-400">
                        </div>

                        <div>
                            <label for="plat" class="block text-sm font-bold text-gray-700 mb-3">üöó Plat Nomor</label>
                            <input type="text" id="plat" name="plat" required placeholder="Contoh: B 1234 ABC"
                                   class="w-full px-5 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 bg-white/80 backdrop-blur-sm text-gray-800 placeholder-gray-400">
                        </div>
                    </div>

                    <div class="space-y-4 pt-4 border-t border-gray-200 mt-6">
                        <h3 class="text-md font-bold text-gray-700">Slot Waktu Plug:</h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div>
                                <label for="jamMulai1" class="block text-sm font-medium text-gray-600 mb-2">‚è∞ Mulai 1</label>
                                <input type="time" id="jamMulai1" name="jamMulai1"
                                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 bg-white/80 backdrop-blur-sm text-gray-800">
                            </div>
                            <div>
                                <label for="jamSelesai1" class="block text-sm font-medium text-gray-600 mb-2">‚è±Ô∏è Selesai 1</label>
                                <input type="time" id="jamSelesai1" name="jamSelesai1"
                                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 bg-white/80 backdrop-blur-sm text-gray-800">
                            </div>
                            <div>
                                <label for="jamMulai2" class="block text-sm font-medium text-gray-600 mb-2">‚è∞ Mulai 2</label>
                                <input type="time" id="jamMulai2" name="jamMulai2"
                                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 bg-white/80 backdrop-blur-sm text-gray-800">
                            </div>
                            <div>
                                <label for="jamSelesai2" class="block text-sm font-medium text-gray-600 mb-2">‚è±Ô∏è Selesai 2</label>
                                <input type="time" id="jamSelesai2" name="jamSelesai2"
                                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 bg-white/80 backdrop-blur-sm text-gray-800">
                            </div>
                            <div>
                                <label for="jamMulai3" class="block text-sm font-medium text-gray-600 mb-2">‚è∞ Mulai 3</label>
                                <input type="time" id="jamMulai3" name="jamMulai3"
                                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 bg-white/80 backdrop-blur-sm text-gray-800">
                            </div>
                            <div>
                                <label for="jamSelesai3" class="block text-sm font-medium text-gray-600 mb-2">‚è±Ô∏è Selesai 3</label>
                                <input type="time" id="jamSelesai3" name="jamSelesai3"
                                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 bg-white/80 backdrop-blur-sm text-gray-800">
                            </div>
                            <div>
                                <label for="jamMulai4" class="block text-sm font-medium text-gray-600 mb-2">‚è∞ Mulai 4</label>
                                <input type="time" id="jamMulai4" name="jamMulai4"
                                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 bg-white/80 backdrop-blur-sm text-gray-800">
                            </div>
                            <div>
                                <label for="jamSelesai4" class="block text-sm font-medium text-gray-600 mb-2">‚è±Ô∏è Selesai 4</label>
                                <input type="time" id="jamSelesai4" name="jamSelesai4"
                                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 bg-white/80 backdrop-blur-sm text-gray-800">
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="catatan" class="block text-sm font-bold text-gray-700 mb-3">üìù Catatan</label>
                        <textarea id="catatan" name="catatan" rows="4" placeholder="Tambahkan catatan atau keterangan tambahan..."
                                  class="w-full px-5 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 bg-white/80 backdrop-blur-sm text-gray-800 placeholder-gray-400 resize-none"></textarea>
                    </div>

                    <div class="pt-6">
                        <button type="submit" id="submitBtn"
                                class="w-full bg-gradient-to-r from-blue-600 via-blue-700 to-indigo-700 text-white font-bold py-5 px-8 rounded-xl hover:from-blue-700 hover:via-blue-800 hover:to-indigo-800 transform hover:scale-[1.02] hover:shadow-2xl transition-all duration-300 shadow-xl relative overflow-hidden group">
                            <span class="relative z-10 flex items-center justify-center text-lg">
                                <span class="mr-3">üíæ</span>
                                Simpan Data
                            </span>
                            <div class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 transform -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-700"></div>
                        </button>
                    </div>
                </form>
            </div>

            <div id="loading" class="loading fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
                <div class="bg-white rounded-lg p-6 text-center">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                    <p class="text-gray-700">Menyimpan data...</p>
                </div>
            </div>
        </div>

        <div id="statusMessage" class="hidden p-4 rounded-lg text-center font-semibold max-w-7xl mx-auto mb-8"></div>

        <div class="glass-effect rounded-2xl custom-shadow mobile-card mb-8 hover-lift animate-fadeInUp">
            <div class="p-6 sm:p-8">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl flex items-center justify-center mr-4">
                            <span class="text-white text-xl">üìä</span>
                        </div>
                        <div>
                            <h3 class="text-xl sm:text-2xl font-bold text-gray-800">Data Plug Kontainer</h3>
                            <p class="text-gray-600 text-sm">Semua data yang tersimpan</p>
                        </div>
                    </div>
                    <button onclick="loadData()" 
                            class="bg-gradient-to-r from-blue-50 to-blue-100 hover:from-blue-100 hover:to-blue-200 text-blue-700 font-semibold py-3 px-6 rounded-xl transition-all duration-300 border border-blue-200 hover:border-blue-300 hover-lift">
                        <span class="flex items-center">
                            <span class="mr-2">üîÑ</span>
                            Refresh Data
                        </span>
                    </button>
                </div>
            
                <div id="dataContainer" class="rounded-xl">
                    <div id="loadingData" class="text-center py-12 text-gray-500">
                        <div class="animate-spin rounded-full h-12 w-12 border-4 border-blue-200 border-t-blue-600 mx-auto mb-4"></div>
                        <p class="text-lg font-medium">Memuat data...</p>
                        <p class="text-sm text-gray-400 mt-1">Mohon tunggu sebentar</p>
                    </div>
                    <div id="noData" class="hidden text-center py-16 text-gray-500">
                        <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-3xl">üìù</span>
                        </div>
                        <p class="text-lg font-medium mb-2">Belum ada data tersimpan</p>
                        <p class="text-sm text-gray-400">Silakan tambahkan data baru menggunakan form di atas</p>
                    </div>
                    
                    <div id="dataTable" class="hidden">
                        <div class="overflow-x-auto -mx-4 sm:mx-0">
                            <div class="inline-block min-w-full align-middle">
                                <table class="min-w-full text-xs sm:text-sm">
                                    <thead>
                                        <tr class="bg-gradient-to-r from-gray-50 to-gray-100 border-b-2 border-gray-200">
                                            <th class="px-2 sm:px-4 py-3 sm:py-4 text-left font-bold text-gray-700 whitespace-nowrap text-xs sm:text-sm">üìÖ Tanggal</th>
                                            <th class="px-2 sm:px-4 py-3 sm:py-4 text-left font-bold text-gray-700 whitespace-nowrap text-xs sm:text-sm">üè∑Ô∏è INV</th>
                                            <th class="px-2 sm:px-4 py-3 sm:py-4 text-left font-bold text-gray-700 whitespace-nowrap text-xs sm:text-sm">üöó Plat</th>
                                            <th class="px-2 sm:px-4 py-3 sm:py-4 text-left font-bold text-gray-700 whitespace-nowrap text-xs sm:text-sm">üîå Durasi Total</th>
                                            <th class="px-2 sm:px-4 py-3 sm:py-4 text-left font-bold text-gray-700 whitespace-nowrap text-xs sm:text-sm hidden lg:table-cell">üìù Catatan</th>
                                            <th class="px-2 sm:px-4 py-3 sm:py-4 text-left font-bold text-gray-700 whitespace-nowrap text-xs sm:text-sm">‚öôÔ∏è Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="dataTableBody" class="divide-y divide-gray-100">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>

        <div class="glass-effect rounded-2xl custom-shadow mobile-card hover-lift animate-fadeInUp">
            <div class="p-6 sm:p-8">
                <div class="flex items-center mb-6">
                    <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-600 rounded-xl flex items-center justify-center mr-4">
                        <span class="text-white text-xl">üöÄ</span>
                    </div>
                    <div>
                        <h3 class="text-xl sm:text-2xl font-bold text-gray-800">Pintasan</h3>
                        <p class="text-gray-600 text-sm">Aksi cepat</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <button onclick="clearForm()" 
                            class="bg-gradient-to-r from-gray-50 to-gray-100 hover:from-gray-100 hover:to-gray-200 text-gray-700 font-semibold py-4 px-6 rounded-xl transition-all duration-300 border border-gray-200 hover:border-gray-300 hover-lift group">
                        <span class="flex items-center justify-center">
                            <span class="mr-3 group-hover:scale-110 transition-transform">üóëÔ∏è</span>
                            Bersihkan Form
                        </span>
                    </button>
                    <button onclick="setCurrentDateTime()" 
                            class="bg-gradient-to-r from-green-50 to-emerald-100 hover:from-green-100 hover:to-emerald-200 text-green-700 font-semibold py-4 px-6 rounded-xl transition-all duration-300 border border-green-200 hover:border-green-300 hover-lift group">
                        <span class="flex items-center justify-center">
                            <span class="mr-3 group-hover:scale-110 transition-transform">üïê</span>
                            Set Waktu Sekarang
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbysnBIvNvleY47LBHbdZTYgV9A8shZAg1-8sAI6T1GIiiVwL92Ne5k0xj3bU4Jsae4p/exec';
        
        // Login credentials
        const VALID_USERNAME = 'plug';
        const VALID_PASSWORD = '1';
        
        // --- Floating Label Logic for Login Modal ---
        document.querySelectorAll('#loginForm input').forEach(input => {
            const group = input.closest('.input-group');
            if (group) {
                if (input.value) {
                    group.classList.add('input-filled');
                }

                input.addEventListener('focus', () => {
                    group.classList.add('input-focused');
                    group.classList.add('input-filled');
                });
                input.addEventListener('blur', () => {
                    group.classList.remove('input-focused');
                    if (!input.value) {
                        group.classList.remove('input-filled');
                    }
                });
                input.addEventListener('input', () => {
                    if (input.value) {
                        group.classList.add('input-filled');
                    } else {
                        group.classList.remove('input-filled');
                    }
                });
            }
        });
        // --- End Floating Label Logic ---


        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            if (isLoggedIn) {
                showMainContent();
            } else {
                showLoginModal();
            }
        }
        
        function showLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('mainContent').classList.add('hidden');
        }
        
        function showMainContent() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
            loadData(); 
        }
        
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const loginError = document.getElementById('loginError');
            
            if (username === VALID_USERNAME && password === VALID_PASSWORD) {
                localStorage.setItem('isLoggedIn', 'true');
                loginError.classList.add('hidden');
                
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                document.querySelectorAll('#loginForm .input-group').forEach(group => group.classList.remove('input-filled'));


                showMainContent();
                showMessage('‚úÖ Login berhasil! Selamat datang.', 'success');
            } else {
                loginError.classList.remove('hidden');
                
                document.getElementById('password').value = '';
                document.querySelector('#loginForm input[name="password"]').closest('.input-group').classList.remove('input-filled');
                
                const modal = document.querySelector('#loginModal > div');
                modal.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    modal.style.animation = '';
                }, 500);
            }
        });
        
        function logout() {
            localStorage.removeItem('isLoggedIn');
            showLoginModal();
            showMessage('üëã Anda telah logout. Sampai jumpa!', 'success');
        }

        document.getElementById('dataForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const loading = document.getElementById('loading');
            const submitBtn = document.getElementById('submitBtn');
            
            loading.classList.add('show');
            submitBtn.disabled = true;
            
            try {
                const formData = new FormData(this);
                
                // IMPORTANT: Ensure the hidden 'lokasi' field is included in the formData
                // It will send an empty string for new entries, preserving the column structure in GAS
                
                const rowValue = document.getElementById('row').value;
                const url = SCRIPT_URL + (rowValue ? `?row=${rowValue}` : '');
                
                const response = await fetch(url, {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    showMessage('‚úÖ Data berhasil disimpan/diperbarui!', 'success');
                    
                    clearForm();
                    
                    loadData();
                } else {
                    throw new Error('Gagal menyimpan data ke Google Sheets');
                }
                
            } catch (error) {
                console.error('Error:', error);
                showMessage('‚ùå Terjadi kesalahan saat memproses data. Cek koneksi atau coba lagi. ' + error.message, 'error');
            } finally {
                loading.classList.remove('show');
                submitBtn.disabled = false;
            }
        });

        function showMessage(message, type) {
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.textContent = message;
            statusMessage.className = `p-4 rounded-lg text-center font-semibold max-w-7xl mx-auto mb-8 ${
                type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
            }`;
            statusMessage.classList.remove('hidden');
            
            setTimeout(() => {
                statusMessage.classList.add('hidden');
            }, 5000);
        }

        function clearForm() {
            document.getElementById('dataForm').reset();
            document.getElementById('row').value = '';
            document.getElementById('submitBtn').innerHTML = '<span class="relative z-10 flex items-center justify-center text-lg"><span class="mr-3">üíæ</span> Simpan Data</span><div class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 transform -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-700"></div>';
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggal').value = today;
        }

        function setCurrentDateTime() {
            const now = new Date();
            
            const today = now.toISOString().split('T')[0];
            document.getElementById('tanggal').value = today;
            
            const currentTime = now.toTimeString().slice(0, 5);
            ['jamMulai1', 'jamMulai2', 'jamMulai3', 'jamMulai4'].forEach(id => {
                document.getElementById(id).value = currentTime;
            });
            showMessage('üïê Tanggal dan Jam Mulai telah diatur ke waktu sekarang.', 'success');
        }

        function checkEditMode() {
            const urlParams = new URLSearchParams(window.location.search);
            const row = urlParams.get('row');
            
            if (row) {
                document.getElementById('row').value = row;
                document.getElementById('submitBtn').innerHTML = '<span class="relative z-10 flex items-center justify-center text-lg"><span class="mr-3">‚úèÔ∏è</span> Update Data</span><div class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 transform -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-700"></div>';
                
                // Fill form with URL parameters
                // NOTE: 'lokasi' is not filled here because the input is hidden, 
                // but its value should be included in the URL params for a complete update (see loadData)
                ['tanggal', 'inv', 'plat', 'lokasi', 'jamMulai1', 'jamSelesai1', 'jamMulai2', 'jamSelesai2', 'jamMulai3', 'jamSelesai3', 'jamMulai4', 'jamSelesai4', 'catatan'].forEach(field => {
                    const value = urlParams.get(field);
                    if (value && document.getElementById(field)) {
                        document.getElementById(field).value = value;
                    }
                });

                showMessage('üìù Data dimuat dari URL untuk diedit.', 'success');
            }
        }

        function calculateTotalDuration(data) {
            let totalMinutes = 0;
            const slots = [1, 2, 3, 4];

            slots.forEach(slot => {
                const mulai = data[`jamMulai${slot}`];
                const selesai = data[`jamSelesai${slot}`];
                
                if (mulai && selesai) {
                    try {
                        const [hMulai, mMulai] = mulai.split(':').map(Number);
                        const [hSelesai, mSelesai] = selesai.split(':').map(Number);

                        const timeMulai = hMulai * 60 + mMulai;
                        let timeSelesai = hSelesai * 60 + mSelesai;

                        if (timeSelesai < timeMulai) {
                            timeSelesai += 24 * 60; 
                        }

                        totalMinutes += (timeSelesai - timeMulai);
                    } catch (e) {
                        console.warn(`Failed to parse time for slot ${slot}: ${mulai}, ${selesai}`, e);
                    }
                }
            });

            if (totalMinutes === 0) return '-';

            const totalHours = Math.floor(totalMinutes / 60);
            const remainingMinutes = totalMinutes % 60;

            let durationStr = '';
            if (totalHours > 0) {
                durationStr += `${totalHours} jam`;
            }
            if (remainingMinutes > 0) {
                if (durationStr) durationStr += ' ';
                durationStr += `${remainingMinutes} mnt`;
            }
            return durationStr.trim() || '-';
        }


        async function loadData() {
            const loadingData = document.getElementById('loadingData');
            const noData = document.getElementById('noData');
            const dataTable = document.getElementById('dataTable');
            const dataTableBody = document.getElementById('dataTableBody');
            
            loadingData.classList.remove('hidden');
            noData.classList.add('hidden');
            dataTable.classList.add('hidden');
            
            try {
                // Column order assumed: Tanggal (0), INV (1), Plat (2), Lokasi (3), JamMulai1 (4), ..., Catatan (12)
                const SHEET_ID = '1Jqa9JiEdIpCG8vr2Cjk3dtx6scEbPhGQZqo4NupO2LI';
                const csvUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=0`;
                
                const response = await fetch(csvUrl);
                const csvText = await response.text();
                
                const rows = csvText.split('\n').filter(row => row.trim());
                const data = [];
                
                // Assuming 13 total columns (Original scheme)
                for (let i = 1; i < rows.length; i++) {
                    const columns = parseCSVRow(rows[i]);
                    // Check if row has data and required columns are present (at least 13 columns)
                    if (columns.length >= 13 && columns[0]) { 
                        const rowData = {
                            rowNumber: i + 1, 
                            tanggal: formatDate(columns[0]),
                            inv: columns[1] || '',
                            plat: columns[2] || '', 
                            lokasi: columns[3] || '', // Lokasi is kept in data for edit link
                            jamMulai1: formatTime(columns[4]),
                            jamSelesai1: formatTime(columns[5]),
                            jamMulai2: formatTime(columns[6]),
                            jamSelesai2: formatTime(columns[7]),    
                            jamMulai3: formatTime(columns[8]),
                            jamSelesai3: formatTime(columns[9]),   
                            jamMulai4: formatTime(columns[10]),
                            jamSelesai4: formatTime(columns[11]),  
                            catatan: columns[12] || ''
                        };
                        
                        rowData.totalDuration = calculateTotalDuration(rowData); 
                        data.push(rowData);
                    }
                }
                
                if (data.length === 0) {
                    loadingData.classList.add('hidden');
                    noData.classList.remove('hidden');
                    return;
                }
                
                dataTableBody.innerHTML = '';
                
                data.forEach((row) => {
                    
                    // Build URL parameters for edit link - ALL FIELDS INCLUDED to prevent data loss on update
                    const editParams = new URLSearchParams({
                        row: row.rowNumber,
                        tanggal: row.tanggal,
                        inv: row.inv,
                        plat: row.plat,
                        lokasi: row.lokasi, // Lokasi included here to pass back to the hidden input
                        jamMulai1: row.jamMulai1,
                        jamSelesai1: row.jamSelesai1,
                        jamMulai2: row.jamMulai2,
                        jamSelesai2: row.jamSelesai2,
                        jamMulai3: row.jamMulai3,
                        jamSelesai3: row.jamSelesai3,
                        jamMulai4: row.jamMulai4,
                        jamSelesai4: row.jamSelesai4,
                        catatan: row.catatan
                    }).toString();

                    const tr = document.createElement('tr');
                    tr.className = 'hover:bg-gradient-to-r hover:from-blue-50/50 hover:to-indigo-50/50 transition-all duration-300 group';
                    
                    tr.innerHTML = `
                        <td class="px-2 sm:px-4 py-3 sm:py-4 font-medium text-gray-800 text-xs sm:text-sm">${row.tanggal || '-'}</td>
                        <td class="px-2 sm:px-4 py-3 sm:py-4 font-bold text-blue-700 text-xs sm:text-sm">${row.inv || '-'}</td>
                        <td class="px-2 sm:px-4 py-3 sm:py-4 font-mono text-gray-700 text-xs sm:text-sm">${row.plat || '-'}</td>
                        
                        <td class="px-2 sm:px-4 py-3 sm:py-4 font-semibold text-purple-700 text-xs sm:text-sm whitespace-nowrap">${row.totalDuration}</td>
                        
                        <td class="px-2 sm:px-4 py-3 sm:py-4 text-xs sm:text-sm text-gray-600 max-w-xs hidden lg:table-cell">
                            <div class="truncate" title="${row.catatan || ''}">${row.catatan ? (row.catatan.length > 30 ? row.catatan.substring(0, 30) + '...' : row.catatan) : '-'}</div>
                        </td>
                        <td class="px-2 sm:px-4 py-3 sm:py-4">
                            <a href="?${editParams}" 
                                    class="bg-gradient-to-r from-blue-50 to-blue-100 hover:from-blue-100 hover:to-blue-200 text-blue-700 font-semibold py-1 sm:py-2 px-2 sm:px-4 rounded-lg transition-all duration-300 border border-blue-200 hover:border-blue-300 text-xs sm:text-sm hover-lift inline-flex items-center">
                                    <span class="mr-1">‚úèÔ∏è</span>
                                    <span class="hidden sm:inline">Edit</span>
                            </a>
                        </td>
                    `;
                    dataTableBody.appendChild(tr);
                });
                
                loadingData.classList.add('hidden');
                dataTable.classList.remove('hidden');
                
            } catch (error) {
                console.error('Error loading data:', error);
                loadingData.classList.add('hidden');
                showMessage('‚ùå Gagal memuat data dari Google Sheets. Coba Refresh Data.', 'error');
                noData.classList.remove('hidden');
            }
        }
        
        // Helper functions (Unchanged)
        function parseCSVRow(row) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < row.length; i++) {
                const char = row[i];
                
                if (char === '"') {
                    if (row[i+1] === '"') { 
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim().replace(/^"|"$/g, '').trim()); 
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim().replace(/^"|"$/g, '').trim());
            return result;
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return '';
            try {
                const date = new Date(dateStr);
                if (!isNaN(date.getTime())) {
                    return date.toISOString().split('T')[0];
                }
                if (dateStr.match(/^\d{1,2}[\/\-]\d{1,2}[\/\-]\d{4}$/)) {
                    const parts = dateStr.split(/[\/\-]/);
                    if (parts.length === 3) {
                        const d = parts[0].padStart(2, '0');
                        const m = parts[1].padStart(2, '0');
                        const y = parts[2];
                        return `${y}-${m}-${d}`;
                    }
                }
                return dateStr;
            } catch (e) {
                return dateStr;
            }
        }
        
        function formatTime(timeStr) {
            if (!timeStr) return '';
            try {
                if (timeStr.includes(':')) {
                    const parts = timeStr.split(':');
                    if (parts.length >= 2) {
                        const hours = parts[0].padStart(2, '0');
                        const minutes = parts[1].padStart(2, '0');
                        return `${hours}:${minutes}`;
                    }
                }
                return timeStr;
            } catch (e) {
                return timeStr;
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus(); 
            checkEditMode();
            
            if (!document.getElementById('tanggal').value) {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('tanggal').value = today;
            }
        });
    </script>
    </body>
</html>

