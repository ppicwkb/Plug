<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pencatatan Plug in Kontainer</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #667eea;
            --primary-dark: #5568d3;
            --secondary: #764ba2;
            --success: #48bb78;
            --danger: #f56565;
            --warning: #ed8936;
            --dark: #2d3748;
            --light: #f7fafc;
            --border: #e2e8f0;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 16px;
            color: var(--dark);
        }
        
        body.locked {
            overflow: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 40px 32px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(20px); }
        }
        
        .header h1 {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 500;
        }
        
        .content {
            padding: 32px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 32px;
            border-bottom: 2px solid var(--border);
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 12px 20px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 15px;
            color: #718096;
            border-bottom: 3px solid transparent;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            position: relative;
        }
        
        .tab-btn:hover {
            color: var(--primary);
        }
        
        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 600;
            font-size: 14px;
            letter-spacing: 0.3px;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
        }
        
        input:hover, textarea:hover, select:hover {
            border-color: #cbd5e0;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .form-section {
            margin-bottom: 28px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
            border-radius: 12px;
            border-left: 4px solid var(--primary);
        }
        
        .form-section h3 {
            margin-bottom: 20px;
            color: var(--dark);
            font-size: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 32px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 28px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
            letter-spacing: 0.3px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: var(--shadow-sm);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.35);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            border: 2px solid var(--border);
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
            border-color: #cbd5e0;
        }
        
        .message {
            padding: 16px 20px;
            border-radius: 8px;
            margin-bottom: 24px;
            display: none;
            animation: slideIn 0.3s ease-out;
            border-left: 4px solid transparent;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .message.success {
            background: #f0fdf4;
            color: #15803d;
            border-left-color: var(--success);
        }
        
        .message.error {
            background: #fef2f2;
            color: #991b1b;
            border-left-color: var(--danger);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 28px;
            border-radius: 12px;
            text-align: center;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(102, 126, 234, 0.25);
        }
        
        .stat-card h3 {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 12px;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            position: relative;
            z-index: 1;
        }
        
        .stat-card .value {
            font-size: 36px;
            font-weight: 800;
            position: relative;
            z-index: 1;
        }
        
        .table-wrapper {
            overflow-x: auto;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            margin-top: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        th {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            color: var(--dark);
            padding: 16px 18px;
            text-align: left;
            font-weight: 700;
            border-bottom: 2px solid var(--border);
            font-size: 13px;
            letter-spacing: 0.4px;
            text-transform: uppercase;
        }
        
        td {
            padding: 16px 18px;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
        }
        
        tr:hover {
            background: #f9fafb;
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .btn-edit, .btn-delete {
            padding: 8px 14px;
            font-size: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .btn-edit {
            background: linear-gradient(135deg, #3182ce 0%, #2c5aa0 100%);
            color: white;
        }
        
        .btn-edit:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(49, 130, 206, 0.25);
        }
        
        .btn-delete {
            background: linear-gradient(135deg, var(--danger) 0%, #c53030 100%);
            color: white;
        }
        
        .btn-delete:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 101, 101, 0.25);
        }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #a0aec0;
        }
        
        .spinner {
            border: 4px solid #e2e8f0;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background-color: white;
            margin: 5vh auto;
            padding: 32px;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            color: var(--dark);
            font-size: 22px;
            font-weight: 700;
        }
        
        .close {
            color: #a0aec0;
            font-size: 28px;
            font-weight: 300;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            background: var(--light);
        }
        
        .close:hover {
            color: var(--dark);
            background: #e2e8f0;
        }
        
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #a0aec0;
        }
        
        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .empty-state h3 {
            color: #718096;
            font-size: 18px;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        /* Login Modal */
        .login-modal {
            display: flex;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .login-container {
            background: white;
            padding: 48px;
            border-radius: 16px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 400px;
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 32px;
        }
        
        .login-header h2 {
            color: var(--dark);
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 8px;
        }
        
        .login-header p {
            color: #718096;
            font-size: 14px;
        }
        
        .login-icon {
            font-size: 48px;
            margin-bottom: 16px;
            color: var(--primary);
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .login-form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .login-form-group label {
            color: var(--dark);
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .login-form-group input {
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .login-form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }
        
        .login-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 8px;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.35);
        }
        
        .login-btn:active {
            transform: translateY(0);
        }
        
        .login-error {
            padding: 12px 16px;
            background: #fef2f2;
            color: #991b1b;
            border-left: 4px solid var(--danger);
            border-radius: 6px;
            font-size: 13px;
            display: none;
            animation: slideIn 0.3s ease-out;
        }
        
        .login-error.show {
            display: block;
        }
        
        .login-loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            
            .header {
                padding: 28px 20px;
            }
            
            .header h1 {
                font-size: 24px;
                flex-direction: column;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
            
            .modal-content {
                margin: 50% auto;
                width: 95%;
                padding: 24px;
            }
            
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 12px 10px;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 4px;
            }
            
            .btn-edit, .btn-delete {
                width: 100%;
                justify-content: center;
            }
            
            .tabs {
                gap: 0;
                margin-bottom: 24px;
            }
            
            .tab-btn {
                flex: 1;
                padding: 10px 12px;
                font-size: 13px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 8px;
            }
            
            .container {
                border-radius: 12px;
                min-height: auto;
            }
            
            .header h1 {
                font-size: 20px;
                gap: 8px;
            }
            
            .header p {
                font-size: 12px;
            }
            
            .content {
                padding: 16px;
            }
            
            .stat-card {
                padding: 20px 16px;
            }
            
            .stat-card .value {
                font-size: 28px;
            }
            
            .form-group {
                margin-bottom: 16px;
            }
            
            .form-section {
                padding: 16px;
                margin-bottom: 20px;
            }
            
            .button-group {
                margin-top: 20px;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .modal-header h2 {
                font-size: 18px;
            }
            
            table {
                font-size: 11px;
            }
            
            th, td {
                padding: 10px 8px;
            }
            
            .tab-btn {
                font-size: 12px;
                padding: 10px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-truck"></i> Sistem Pencatatan Plug in</h1>
            <p>data pencatatan plug in kontainer</p>
        </div>
        
        <div class="content">
            <div class="message" id="message"></div>
            
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('input')">
                    <i class="fas fa-edit"></i> Input Data
                </button>
                <button class="tab-btn" onclick="switchTab('view')">
                    <i class="fas fa-list"></i> Lihat Data
                </button>
            </div>
            
            <!-- Tab Input Data -->
            <div id="input" class="tab-content active">
                <form id="dataForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tanggal"><i class="fas fa-calendar"></i> Tanggal</label>
                            <input type="date" id="tanggal" name="tanggal" required>
                        </div>
                        <div class="form-group">
                            <label for="inv"><i class="fas fa-receipt"></i> No. Invoice</label>
                            <input type="text" id="inv" name="inv" placeholder="Masukkan nomor invoice" required>
                        </div>
                        <div class="form-group">
                            <label for="plat"><i class="fas fa-car"></i> Plat Nomor</label>
                            <input type="text" id="plat" name="plat" placeholder="Contoh: AB 1234 CD" required>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3><i class="fas fa-clock"></i> Jam Plug in kontainer</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="jamMulai1">Jam Mulai 1</label>
                                <input type="time" id="jamMulai1" name="jamMulai1">
                            </div>
                            <div class="form-group">
                                <label for="jamSelesai1">Jam Selesai 1</label>
                                <input type="time" id="jamSelesai1" name="jamSelesai1">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="jamMulai2">Jam Mulai 2</label>
                                <input type="time" id="jamMulai2" name="jamMulai2">
                            </div>
                            <div class="form-group">
                                <label for="jamSelesai2">Jam Selesai 2</label>
                                <input type="time" id="jamSelesai2" name="jamSelesai2">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="jamMulai3">Jam Mulai 3</label>
                                <input type="time" id="jamMulai3" name="jamMulai3">
                            </div>
                            <div class="form-group">
                                <label for="jamSelesai3">Jam Selesai 3</label>
                                <input type="time" id="jamSelesai3" name="jamSelesai3">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="jamMulai4">Jam Mulai 4</label>
                                <input type="time" id="jamMulai4" name="jamMulai4">
                            </div>
                            <div class="form-group">
                                <label for="jamSelesai4">Jam Selesai 4</label>
                                <input type="time" id="jamSelesai4" name="jamSelesai4">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="catatan"><i class="fas fa-sticky-note"></i> Catatan</label>
                        <textarea id="catatan" name="catatan" placeholder="Masukkan catatan tambahan..."></textarea>
                    </div>
                    
                    <div class="button-group">
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-save"></i> Simpan Data
                        </button>
                        <button type="reset" class="btn-secondary">
                            <i class="fas fa-redo"></i> Reset Form
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Tab Lihat Data -->
            <div id="view" class="tab-content">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 28px; flex-wrap: wrap; gap: 16px;">
                    <h2 style="color: var(--dark); font-size: 22px; font-weight: 700;">
                        <i class="fas fa-database"></i> Data Plug in Kontainer
                    </h2>
                    <button class="btn-primary" onclick="refreshData()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
                
                <div id="statsContainer" class="stats"></div>
                
                <div id="dataContainer" class="table-wrapper">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Memuat data...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Edit -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Edit Data</h2>
                <span class="close" onclick="closeEditModal()"><i class="fas fa-times"></i></span>
            </div>
            <form id="editForm">
                <input type="hidden" id="editRowIndex">
                <div class="form-row">
                    <div class="form-group">
                        <label>Tanggal</label>
                        <input type="date" id="editTanggal" required>
                    </div>
                    <div class="form-group">
                        <label>No. Invoice</label>
                        <input type="text" id="editInv" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Plat Nomor</label>
                    <input type="text" id="editPlat" required>
                </div>
                <div class="form-section">
                    <h3><i class="fas fa-clock"></i> Jam Plug in</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Jam Mulai 1</label>
                            <input type="time" id="editJamMulai1">
                        </div>
                        <div class="form-group">
                            <label>Jam Selesai 1</label>
                            <input type="time" id="editJamSelesai1">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Jam Mulai 2</label>
                            <input type="time" id="editJamMulai2">
                        </div>
                        <div class="form-group">
                            <label>Jam Selesai 2</label>
                            <input type="time" id="editJamSelesai2">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Jam Mulai 3</label>
                            <input type="time" id="editJamMulai3">
                        </div>
                        <div class="form-group">
                            <label>Jam Selesai 3</label>
                            <input type="time" id="editJamSelesai3">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Jam Mulai 4</label>
                            <input type="time" id="editJamMulai4">
                        </div>
                        <div class="form-group">
                            <label>Jam Selesai 4</label>
                            <input type="time" id="editJamSelesai4">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Catatan</label>
                    <textarea id="editCatatan"></textarea>
                </div>
                <div class="button-group">
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-save"></i> Perbarui
                    </button>
                    <button type="button" class="btn-secondary" onclick="closeEditModal()">
                        <i class="fas fa-times"></i> Batal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwwPaTCXkQ88IoukODJtLdFdPzNIM1zPD1cynMCBtgrgFnu79c3rIoPKAnx66SA8HxM/exec';
        const VALID_USERNAME = 'plug';
        const VALID_PASSWORD = '1';
        
        let isLoggedIn = false;
        
        // Initialize login on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggal').value = today;
        });
        
        function checkLoginStatus() {
            // Check if user is logged in from sessionStorage
            isLoggedIn = sessionStorage.getItem('loggedIn') === 'true';
            
            if (!isLoggedIn) {
                showLoginModal();
            }
        }
        
        function showLoginModal() {
            const loginModal = document.createElement('div');
            loginModal.className = 'login-modal';
            loginModal.id = 'loginModal';
            loginModal.innerHTML = `
                <div class="login-container">
                    <div class="login-header">
                        <div class="login-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                        <h2>Akses Sistem</h2>
                        <p>Masukkan kredensial Anda untuk melanjutkan</p>
                    </div>
                    <form id="loginForm" class="login-form" onsubmit="handleLogin(event)">
                        <div class="login-error" id="loginError">
                            <i class="fas fa-exclamation-circle"></i> Username atau password salah
                        </div>
                        <div class="login-form-group">
                            <label for="loginUsername">
                                <i class="fas fa-user"></i> Username
                            </label>
                            <input 
                                type="text" 
                                id="loginUsername" 
                                placeholder="Masukkan username" 
                                required
                                autofocus
                            >
                        </div>
                        <div class="login-form-group">
                            <label for="loginPassword">
                                <i class="fas fa-key"></i> Password
                            </label>
                            <input 
                                type="password" 
                                id="loginPassword" 
                                placeholder="Masukkan password" 
                                required
                            >
                        </div>
                        <button type="submit" class="login-btn">
                            <i class="fas fa-sign-in-alt"></i> Masuk
                        </button>
                    </form>
                </div>
            `;
            document.body.insertBefore(loginModal, document.body.firstChild);
            document.body.classList.add('locked');
        }
        
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const loginBtn = event.target.querySelector('.login-btn');
            const loginError = document.getElementById('loginError');
            
            // Clear error message
            loginError.classList.remove('show');
            
            if (username === VALID_USERNAME && password === VALID_PASSWORD) {
                // Login successful
                isLoggedIn = true;
                sessionStorage.setItem('loggedIn', 'true');
                
                // Add loading state
                loginBtn.classList.add('login-loading');
                loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memverifikasi...';
                
                // Close login modal after delay
                setTimeout(() => {
                    const loginModal = document.getElementById('loginModal');
                    if (loginModal) {
                        loginModal.remove();
                    }
                    document.body.classList.remove('locked');
                    loginBtn.classList.remove('login-loading');
                    loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Masuk';
                }, 1000);
            } else {
                // Login failed
                loginError.classList.add('show');
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
                document.getElementById('loginUsername').focus();
            }
        }
        
        
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggal').value = today;
        });
        
        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.closest('.tab-btn').classList.add('active');
            
            if (tabName === 'view') {
                refreshData();
            }
        }
        
        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i> ${text}`;
            messageEl.className = `message ${type}`;
            setTimeout(() => {
                messageEl.className = 'message';
            }, 4000);
        }
        
        document.getElementById('dataForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const data = {
                tanggal: document.getElementById('tanggal').value,
                inv: document.getElementById('inv').value,
                plat: document.getElementById('plat').value,
                jamMulai1: document.getElementById('jamMulai1').value,
                jamSelesai1: document.getElementById('jamSelesai1').value,
                jamMulai2: document.getElementById('jamMulai2').value,
                jamSelesai2: document.getElementById('jamSelesai2').value,
                jamMulai3: document.getElementById('jamMulai3').value,
                jamSelesai3: document.getElementById('jamSelesai3').value,
                jamMulai4: document.getElementById('jamMulai4').value,
                jamSelesai4: document.getElementById('jamSelesai4').value,
                catatan: document.getElementById('catatan').value
            };
            
            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify(data)
            })
            .then(response => response.text())
            .then(result => {
                showMessage('Data berhasil disimpan!', 'success');
                document.getElementById('dataForm').reset();
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('tanggal').value = today;
            })
            .catch(error => {
                showMessage('Gagal menyimpan data: ' + error, 'error');
            });
        });
        
        function refreshData() {
            const container = document.getElementById('dataContainer');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Memuat data...</p></div>';
            
            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({action: 'get'})
            })
            .then(response => response.json())
            .then(data => {
                if (data && data.length > 0) {
                    const uniquePlates = new Set(data.map(row => row[3])).size;
                    const totalRecords = data.length;
                    
                    let statsHtml = `
                        <div class="stat-card">
                            <h3>∑ Total Records</h3>
                            <div class="value">${totalRecords}</div>
                        </div>
                        <div class="stat-card">
                            <h3>🚛 Total Kontainer </h3>
                            <div class="value">${uniquePlates}</div>
                        </div>
                    `;
                    
                    document.getElementById('statsContainer').innerHTML = statsHtml;
                    
                    let html = `
                        <table>
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Timestamp</th>
                                    <th>Tanggal</th>
                                    <th>Invoice</th>
                                    <th>Plat</th>
                                    <th>Jam 1</th>
                                    <th>Jam 2</th>
                                    <th>Jam 3</th>
                                    <th>Jam 4</th>
                                    <th>Catatan</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    function formatTanggal(tgl) {
    if (!tgl || tgl === '-') return '-';
    const date = new Date(tgl);
    if (isNaN(date)) return '-';
    const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
    return date.toLocaleDateString('id-ID', options);
}

function formatJam(jam) {
    if (!jam || jam === '-' || jam === 'Invalid Date') return '-';
    const date = new Date(jam);
    if (isNaN(date)) return '-';
    return date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', hour12: false });
}

data.forEach((row, index) => {
    // Format jam mulai & selesai
    const jam1 = row[4] && row[5] ? `${formatJam(row[4])} - ${formatJam(row[5])}` : '-';
    const jam2 = row[6] && row[7] ? `${formatJam(row[6])} - ${formatJam(row[7])}` : '-';
    const jam3 = row[8] && row[9] ? `${formatJam(row[8])} - ${formatJam(row[9])}` : '-';
    const jam4 = row[10] && row[11] ? `${formatJam(row[10])} - ${formatJam(row[11])}` : '-';

    html += `
        <tr>
            <td>${index + 1}</td>
            <td><small>${formatTanggal(row[0])}</small></td>
            <td>${formatTanggal(row[1])}</td>
            <td>${(row[2])}</td>
            <td><strong>${row[3]}</strong></td>
            <td>${jam1}</td>
            <td>${jam2}</td>
            <td>${jam3}</td>
            <td>${jam4}</td>
            <td>${row[12] ? row[12].substring(0, 25) + '...' : '-'}</td>
            <td>
                <div class="action-buttons">
                    <button class="btn-edit" onclick="openEditModal(${index}, ${JSON.stringify(row).replace(/"/g, '&quot;')})">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn-delete" onclick="deleteRow(${index})">
                        <i class="fas fa-trash"></i> Hapus
                    </button>
                </div>
            </td>
        </tr>
    `;
});
                    
                    html += '</tbody></table>';
                    container.innerHTML = html;
                } else {
                    document.getElementById('statsContainer').innerHTML = '';
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">📦</div>
                            <h3>Tidak ada data</h3>
                            <p>Belum ada catatan kendaraan. Silakan tambahkan data baru di tab Input Data.</p>
                        </div>
                    `;
                }
            })
            .catch(error => {
                container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">⚠️</div><h3>Error</h3><p>Gagal memuat data: ${error}</p></div>`;
                console.error('Error:', error);
            });
        }
        
        function openEditModal(index, row) {
            document.getElementById('editRowIndex').value = index;
            document.getElementById('editTanggal').value = row[1];
            document.getElementById('editInv').value = row[2];
            document.getElementById('editPlat').value = row[3];
            document.getElementById('editJamMulai1').value = row[4];
            document.getElementById('editJamSelesai1').value = row[5];
            document.getElementById('editJamMulai2').value = row[6];
            document.getElementById('editJamSelesai2').value = row[7];
            document.getElementById('editJamMulai3').value = row[8];
            document.getElementById('editJamSelesai3').value = row[9];
            document.getElementById('editJamMulai4').value = row[10];
            document.getElementById('editJamSelesai4').value = row[11];
            document.getElementById('editCatatan').value = row[12];
            
            document.getElementById('editModal').style.display = 'block';
        }
        
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }
        
        document.getElementById('editForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const index = document.getElementById('editRowIndex').value;
            const data = {
                action: 'update',
                rowIndex: index,
                data: {
                    tanggal: document.getElementById('editTanggal').value,
                    inv: document.getElementById('editInv').value,
                    plat: document.getElementById('editPlat').value,
                    jamMulai1: document.getElementById('editJamMulai1').value,
                    jamSelesai1: document.getElementById('editJamSelesai1').value,
                    jamMulai2: document.getElementById('editJamMulai2').value,
                    jamSelesai2: document.getElementById('editJamSelesai2').value,
                    jamMulai3: document.getElementById('editJamMulai3').value,
                    jamSelesai3: document.getElementById('editJamSelesai3').value,
                    jamMulai4: document.getElementById('editJamMulai4').value,
                    jamSelesai4: document.getElementById('editJamSelesai4').value,
                    catatan: document.getElementById('editCatatan').value
                }
            };
            
            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify(data)
            })
            .then(response => response.text())
            .then(result => {
                showMessage('Data berhasil diperbarui!', 'success');
                closeEditModal();
                refreshData();
            })
            .catch(error => {
                showMessage('Gagal memperbarui data: ' + error, 'error');
            });
        });
        
        function deleteRow(index) {
            if (confirm('Apakah Anda yakin ingin menghapus data ini?')) {
                fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'delete',
                        rowIndex: index
                    })
                })
                .then(response => response.text())
                .then(result => {
                    showMessage('Data berhasil dihapus!', 'success');
                    refreshData();
                })
                .catch(error => {
                    showMessage('Gagal menghapus data: ' + error, 'error');
                });
            }
        }
        
        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>
